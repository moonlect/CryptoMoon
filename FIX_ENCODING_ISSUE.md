# Решение проблемы UnicodeDecodeError с psycopg2 на Windows

## Проблема
При попытке запустить миграции Alembic возникает ошибка:
```
UnicodeDecodeError: 'utf-8' codec can't decode byte 0xc2 in position 61: invalid continuation byte
```

## Причина
Проблема связана с тем, что psycopg2 на Windows пытается декодировать системные сообщения об ошибках (возможно, на русском языке) как UTF-8, но они закодированы в другой кодировке (Windows-1251 или CP866).

## Решения

### Вариант 1: Использовать psycopg (версия 3) вместо psycopg2
psycopg3 - это новая версия, которая лучше обрабатывает кодировки:

```bash
pip uninstall psycopg2-binary
pip install psycopg[binary]
```

Затем нужно обновить код для использования psycopg3.

### Вариант 2: Изменить системную локаль Windows
1. Откройте "Панель управления" → "Региональные стандарты"
2. Измените формат на "Английский (США)" или другую UTF-8 локаль
3. Перезапустите терминал и попробуйте снова

### Вариант 3: Использовать WSL (Windows Subsystem for Linux)
Запустите миграции в WSL, где кодировки обрабатываются лучше:

```bash
wsl
cd /mnt/c/Users/user/PycharmProjects/CryptoMoon
source .venv1/bin/activate
alembic upgrade head
```

### Вариант 4: Запустить миграции в Docker контейнере
Используйте Docker для запуска миграций:

```bash
docker-compose exec backend alembic upgrade head
```

### Вариант 5: Временно изменить пароль базы данных на ASCII-only
Если в пароле есть не-ASCII символы, попробуйте использовать только ASCII символы.

## Текущий статус
Проблема воспроизводится даже при прямом подключении через psycopg2.connect(). 
База данных работает нормально (проверено через psql).
Проблема специфична для psycopg2 на Windows с русской локализацией.

## Рекомендация
Использовать **Вариант 4** (Docker) или **Вариант 3** (WSL) для запуска миграций, 
так как они обходят проблему с кодировкой Windows.

