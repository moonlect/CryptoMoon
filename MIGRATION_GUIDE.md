# Руководство по миграциям базы данных

## Создание первой миграции

После настройки проекта и создания всех моделей, создайте первую миграцию:

```bash
alembic revision --autogenerate -m "Initial migration"
```

Эта команда создаст файл миграции в `alembic/versions/` с автоматически сгенерированными изменениями на основе ваших моделей.

## Применение миграций

```bash
alembic upgrade head
```

Эта команда применит все миграции до последней версии.

## Откат миграции

```bash
alembic downgrade -1
```

Откатывает последнюю миграцию.

## Проверка текущей версии

```bash
alembic current
```

## Создание пустой миграции

Если нужно создать миграцию вручную:

```bash
alembic revision -m "Description of changes"
```

## Важные замечания

1. **Перед созданием миграции:**
   - Убедитесь, что все модели импортированы в `alembic/env.py`
   - Проверьте, что `database_url_sync` правильно настроен в `.env`

2. **После создания миграции:**
   - Проверьте сгенерированный код миграции
   - Убедитесь, что все изменения корректны
   - При необходимости отредактируйте файл миграции вручную

3. **В production:**
   - Всегда делайте backup базы данных перед применением миграций
   - Тестируйте миграции на staging окружении
   - Применяйте миграции в maintenance window

## Структура миграции

Файл миграции содержит две функции:
- `upgrade()` - применяет изменения
- `downgrade()` - откатывает изменения

Пример:

```python
def upgrade() -> None:
    op.create_table(
        'users',
        sa.Column('id', sa.Integer(), nullable=False),
        sa.Column('email', sa.String(255), nullable=False),
        # ...
    )

def downgrade() -> None:
    op.drop_table('users')
```



